---
title: "Series02-RStudio: Correlations and statistical tests"
author: "Joël SINGER"
date: "`r format(Sys.time(), '%d %B, %Y, %H:%M')`"
output:
  html_document:
    df_print: paged
    code_folding: hide
    toc: false
    number_sections: true
---

# Correlations and linear regression
In this series of exercises, you will explore correlations and linear regression, using a dataset from a real experiment.


## The problem
You want to know if there is a relationship between the nonuse of the proximal part of the upper limb (PANU) and the nonuse of the shoulder (SANU) or the elbow (EENU). 


## The data
As you will see, the data is far from perfect, but this is the reality of experimental data, especially in the case of clinical data.

Download the file NonUse.csv from the course Moodle.

```{r load-data, message=FALSE, warning=FALSE}
nonuse <- read.csv("data/test_data/NonUse.csv", sep = ",", header=TRUE)
head(nonuse)
summary(nonuse)
```


This file contains measures of upper extremity nonuse:

- PANU: Proximal Arm Non Use
- SANU: Shoulder Antepulsion Non Use
- EENU: Elbow Extension Non Use

In your notebook, make a clear description of the experiment, the variables and the data. Do not forget to give the units of each variable, and the range of possible values.\

  | name | description | unit | range |
  |------|-------------|------|-------|
  | PANU | Proximal Arm Non Use | % | 0-100 |
  | SANU | Shoulder Antepulsion Non Use | % | 0-100 |
  | EENU | Elbow Extension Non Use | % | 0-100 |


## Correlation analysis
Below are some questions to guide your analysis.

- Is PANU correlated with SANU and/or EENU?

We use a Spearman correlation, because we do not have assumptions about data distribution, and we do not assume a linear relationship between the variables.
```{r correlation-tests}
cor.test(nonuse$PANU, nonuse$SANU, method = "spearman")
cor.test(nonuse$PANU, nonuse$EENU, method = "spearman")
```


- Visualize the PANU-SANU relationship (and the PANU-EENU relationship)

```{r plot-correlations}
library(ggplot2)
p1 <- ggplot(nonuse, aes(x = PANU, y = SANU)) +
  geom_point() +
  xlim(-100, 100) +
  ylim(-100, 100) +
  labs(title = "PANU vs SANU", subtitle = "Whole possible range of data", x = "PANU (%)", y = "SANU (%)") +
  theme_minimal()

p2 <- ggplot(nonuse, aes(x = PANU, y = EENU)) +
  geom_point() +
  xlim(-100, 100) +
  ylim(-100, 100) +
  labs(title = "PANU vs EENU", subtitle = "Whole possible range of data", x = "PANU (%)", y = "EENU (%)") +
  theme_minimal()

show(p1)
show(p2)
```


- Perform a linear regression for PANU-SANU (and for PANU-EENU)

We do not predict a linear regression, but let us see it nonetheless.

```{r panu-sanu_linear-regression}
library(ggplot2)
p1 <- ggplot(nonuse, aes(x = PANU, y = SANU)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  # xlim(-100, 100) +
  # ylim(-100, 100) +
  labs(title = "PANU vs SANU", x = "PANU (%)", y = "SANU (%)") +
  theme_minimal()

show(p1)
```
```{r panu-eenu_linear-regression}
library(ggplot2)
p1 <- ggplot(nonuse, aes(x = PANU, y = EENU)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  # xlim(-100, 100) +
  # ylim(-100, 100) +
  labs(title = "PANU vs EENU", x = "PANU (%)", y = "EENU (%)") +
  theme_minimal()

show(p1)
```


- Give the regression equations: PANU = a * SANU + b and PANU = a * EENU + b

```{r regression-equations}
model_sanu <- lm(PANU ~ SANU, data = nonuse)
summary(model_sanu)
coefficients_sanu <- coefficients(model_sanu)
a_sanu <- coefficients_sanu["SANU"]
b_sanu <- coefficients_sanu["(Intercept)"]
cat("Regression equation for PANU as a function of SANU: PANU =", a_sanu, "* SANU +", b_sanu, "\n")
model_eenu <- lm(PANU ~ EENU, data = nonuse)
summary(model_eenu)
coefficients_eenu <- coefficients(model_eenu)
a_eenu <- coefficients_eenu["EENU"]
b_eenu <- coefficients_eenu["(Intercept)"]
cat("Regression equation for PANU as a function of EENU: PANU =", a_eenu, "* EENU +", b_eenu, "\n")
```

- Summarize your results as you would do in your master’s thesis report, or as in a scientific article (e.g., What sentence will you write in the article explaining your result?).

PANU is significantly correlated with SANU and EENU according to the Spearman test (p < 0.01), meaning that higher values of SANU and EENU are associated with higher values of PANU. However, when we tested the linear correlation, we found no significant relationship between PANU and SANU (p = 0.17), but a significant (p < 0.001), although poor (adjusted r² = 0.22), linear correlation between PANU and EENU. This suggests that while there is a monotonic relationship between these variables, the EENU seems more reliable to describe PANU.

- What are the limits of your analysis?

This analysis does not propose a combined model of SANU and EENU to describe PANU, which could be more informative. Additionally, the data may contain non-linear relationships that are not captured by the linear regression model, although the data distribution does not suggest it. Furthermore, we did not test for normality or even check visually the variables distribution, which could have given insights about the statistical power of the sample, or the statistical tests to use.




# Statistical tests: comparison of medians (or means?)
In this series of exercises, you will explore how to compare two groups of data, using non-parametric tests (or parametric tests… if it makes sense to do so).


## Make clear what is a statistical test, and when to use it.
Below are some questions to guide your analysis. You can answer them in your notebook, with a short sentence for each question.

- What is a median? A mean?


- What is a variance? A standard deviation?


- What is a normal distribution?


- What is a statistical test?


- When to use a statistical test?


- What is a parametric test? A non-parametric test?


- What are the assumptions of parametric tests?


- What are the assumptions of non-parametric tests?


- What is a p-value?


- What is the risk of error when using a statistical test?


- What is the difference between a paired and an unpaired test?


- You can use your favorite LLM, book or web site to answer these questions, but you have to provide at least one reference for each answer (book, article, URL, LLM prompt, etc.).


## Effect of treatment over time
This is a very classical question in clinical or sport research: does a treatment-training have an effect over time?

To answer this question scientifically, measurements must be taken before and after treatment, and possibly later, in order to assess whether the effect is lasting or not.

### The data
Download the file PrePost.csv

This file contains before/after measurements. The treatment is a rehabilitation training for individuals with cardiac conditions.

Before going further, you have to make clear what are the measured variables. 
- What do they measure? 


- What are the units? 


- What are the possible values? 


- What are the expected changes over rehabilitation.


Make a table, with one row per variable, and the following columns:

| Variable | Description | Unit | Possible values | Expected change |

| Variable | Description | Unit | Possible values | Expected change |
|----------|-------------|------|-----------------|-----------------|
| VO2peak  | Peak oxygen uptake during exercise | ml/kg/min | 0-100+ | Increase |

### The analysis
You want to know if the treatment has an effect on one or more of the measured variables.

- Does the treatment have an effect?


- What comparison are you going to make?


- Which test will you use? Parametric or non-parametric?


- Which graph illustrates the effect of the treatment?


- What sentence will you write in your thesis to explain your result?



## Testing some stereotypes
Humans have stereotypes, some of them are probably true, some others are probably false (e.g., ref ).

Here, we will test stereotypes about snorers… among others.

### The data
Download the file snore.txt

This file contains anthropometric and qualitative measurements (1 person per line).

### The analysis
Do the data confirm the following stereotypes? Provide a reasoned answer (data, figure, result sentence) for each question.
- Are snorers fatter?


- Do snorers drink or smoke more?


- Are men fatter?


- Do women smoke less?


- From a more general perspective: are there any correlations between variables?
